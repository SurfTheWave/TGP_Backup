public class DataUpload{

    public void processOpportunity(){
    
        //Savepoint sp = new Database.setSavepoint();
                
    List<Opportunity_Teams__c> oppTeamsList = new List<Opportunity_Teams__c>();
    List<Opportunity_Teams__c> oppTeamsListToUpdate = new List<Opportunity_Teams__c>();
    List<Opportunity_Teams__c> oppTeamsListToAdd = new List<Opportunity_Teams__c>();
    Boolean oppHasComm = false;
    //List<User_Master__c>  = [SELECT Id, Name, Active__c, User__c FROM User_Master__c];
    /*Map<String, String> userMap =new Map<String, String>();
                                                    
    for(User_Master__c um :[SELECT Id, Name, Active__c, User__c FROM User_Master__c WHERE Active__c=true and name = 'Mahesh Chennamkumarath']){
                    userMap.put(um.Name, um.Id);
    }*/
                
                
    Map<string, String> mapOfOppID = new Map<string, String>();
    Set<string> MSet = new Set<string>{'10471835'};//,'10496196','10512634','10490464','709675','698406','10500564','704335','10467274','10502304','707374','10459891','10498003','675671','10519606','670766','10469661','10490904','10461555','707423','10499668','705800','420285','10466683','706126','10278778','10522085','10460177','677613','635464','10455019','10469755','464887','10475828','10496773','698591','585495','10500589','10509866','10461856','634036','10469745','683396','10496634','10493543','10513779','10460694','704859','702348','10456748','10464635','10284130','511736','573454','10525732','709931','10468916','10279531','701771','10488694','698533','706158','10525733','704675','704834','704820','580927','694881','680744','706747','10513761','10517271','10522955','10527636','10491553','10460688','10493540','10505574','10486348','10527207','10526714','698130','10527216','10526723','10471609','10280139','10504747','10527204','10526716','10504751','10503305','703367','10498154','10472699','10469860','10476246','10525736','696999','10525443','10525071','10512352','10505470','10456304','10504737','10526710','10526704','10510755','709665','10496585','10525738','621803','10509982','10510091','10469659','641366','10457043','10469931','10490589','593997','10470517','612930','629836','10529718','659237','696085','707143','10529212','661436','10278731','706661','10471202','636030','10466707'};
    System.debug('Line 9');
    //Set<string> CSet = new Set<string>{'10490865'};//,'10285127','10506371','10281118','10484566','10458744','593887','10506824','10506846','10283312','10513606','10286639','10506245','10278654','657982','10466084','617735','10493935','500055','10491088','10464749','518960','636330','10526020','10469338','10454779','10464311','10278195','522896','10477180','595149','613783','10469318','10277945','620527','697944','10473779','10466218','614908','10455298','10493887','699804','473145','10526972','10495661','667691','681957','10482630','10509899','10506840','688124','10454640','10510378','10457921','10512493','689885','10508343','609696','10520424','597965','700096','701395','10469343','659155','530685','10515900','611789','633479','677883','670010','10503332','687983','10462476','633850','10285012','10464789','10469315','524866','10513617','617271','695874','10497894','701654','699680','676995','10278240','10513996','10476639','702882','652634','10074910','702109','10279458','10276891','620128','10473762','10486187','373827','689914','684503','10524358','10506538','10506878','10509753','681605','670121','10510246','10519700','697099','10497994','10489703','10491846','10489938','10462472','691034','10488487','647994','10458133','593389','662737','680059','10464734','10468612','687432','581714','652696','10509888','10491294','10470076','699717','10464210','10464208','633894','625124','663127','10514001','10506805','10499299','10506289','10460164','620751','700083','676606','681860','10527448','670303','10527920','10529910','685300','703144','661052','10477150','10529917','633892','10494444','703284','10529055','10456591','10528455','640956','10282862','683845','620756','10284712'};
    //Set<string> DSet = new Set<string>{'10488370'};//,'10487945','10278226','666850','10508760','541874','10465169','10501353','10284262','10473489','10454484','650183','10074264','10523686','10468881','10488450','604369','10278393','671992','610762','10508186','10284363','10519292','10517080','10278104','10500302','700817','10455927','10455945','10493760','10501347','562204','679401','678752','10482242','666971','10506349','618216','10471692','10461247','10454967','10501304','610528','10504642','655752','10522506','10521873','10505752','10520600','10481830','10500846','685178','537987','549614','10513500','10491624','604928','10476262','10523796','10523771','10478454','684318','10501314','709275','10500180','679500','10487814','10508553','10482341','10477005','649489','10516061','649491','604358','648785','10519917','703456','697825','10530275','10074162','10529391','708848','626770','10477879','10529387','633218'};
    //Set<string> DenSet = new Set<string>{'10279507','620051','10504363','649038','562693','610618','661475','10282653','682644','611106','651046','10502215','10480313','665908','624339','659223','659928','686874','518521','666706','611103','10276557','10493744','695329','593755','444438','10280380','583361','10481297','524654','10506395','10507394','10483151','10459087','685424','635417','587475','10286939','562745','10503510','533656','650797','692917','10454034','10488844','10285174','623964','562695','683851','10512689','10504675','10491023','10454101','660919','634253','10509568','10287284','691465','10476777','630324','10521032','10509566','10480287','697672','687990','10494347','10477444','10477440','10476161','10460208','10460377','10497561','10283605','10278303','492235','10285494','681796','652397','10521756','10482523','639532','10485677','10488669','661511','10459299','544056','10283159','10283163','10497077','674373','10286451','10285897','656120','10486502','10488316','623296','676046','633876','654468','10476160','662617','10528699','10527953','10530069','503839','10527629','562691','637919','623171','670568'};
    //Set<string> NSet = new Set<string>{'10507307','684591','700896','691472','684791','10497233','684493','684776','689453','692125','684817','10515932','10480205','709442','705551','10277906','590418','10492837','620642','10491922','10509186','10473520','649711','10515949','10467585','606378','596401','692526','706552','653692','10501402','10494715','10468702','587817','685828','578594','697928','10494203','10457990','499225','644649','570462','681295','708531','669850','673280','592307','10491929','667140','628395','10504099','708650','660016','540519','10516059','642732','10522090','10466141','10510875','10524114','10502720','706364','10509893','708284','10515706','10500408','10464907','10468426','10515992','10499007','10484885','664270','10515988','10526574','10484854','10474225','10503862','10512490','698946','700693','680852','10519022','10512502','10464857','10513061','10488080','621236','707499','10465231','690422','10496693','10465281','10282364','703505','10471856','10480271','677106','707094','639340','10492903','10501229','10501226','517247','669904','706086','10489408','701957','10484983','10502840','10506258','565194','10505237','524332','706764','701215','10526164','705488','540518','10461299','10511026','691294','611060'};
                
                System.debug('Line 13');
                
    for(String mValue: MSet)
    {
        mapOfOppID.put(mValue, 'a5j560000008Os1AAE');
    }

    System.debug('29');

    
    
    Opportunity_Roles_Master__c RoleMAster = [SELECT Id, Name, Active__c, Role_Level__c FROM Opportunity_Roles_Master__c where Name ='Commercial Team' LIMIT 1];
    
   
    
    List<opportunity> oppList=[SELECT id,SAP_OM_ID__c , (SELECT Id, Name, Role__c, Role__r.Name from Opportunity_Team__r) from Opportunity where SAP_OM_ID__c IN: mapOfOppID.keySet() LIMIT 100]; 
    
    System.debug('Map line 35'+ oppList.size() );    
    if(oppList.size() > 0){
        for(Opportunity opp : oppList){
            System.debug('line no 39');
            for(Opportunity_Teams__c oppTeam : opp.Opportunity_Team__r){
                if(oppTeam.Role__c !=null && oppTeam.Role__r.Name == 'Commercial Team'){
                    if(oppTeam.Opportunity_Team_Member__c!=mapOfOppID.get(opp.SAP_OM_ID__c) ){
                         oppTeam.Opportunity_Team_Member__c = mapOfOppID.get(opp.SAP_OM_ID__c);
                         oppTeamsListToUpdate.add(oppTeam);     
                    }
                    oppHasComm = true;
                }
                
            }
            if(!oppHasComm)
            {
                Opportunity_Teams__c oppMember= new Opportunity_Teams__c();
                oppMember.Role__c = RoleMAster.id; 
                oppMember.Opportunity_Team_Member__c = mapOfOppID.get(opp.SAP_OM_ID__c);
                oppTeamsList.add(oppMember);
            }
        }
    }
    System.debug('line no --76');

    }
}